<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Happy Birthday</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <link rel="stylesheet" href="./style.css">

  <!-- ‚úÖ Preload audio early to reduce buffering -->
  <link rel="preload" as="audio" href="./1.mp3" type="audio/mpeg">
</head>

<body>

  <!-- ‚úÖ Background music (must be served from same site/path) -->
  <audio id="bgMusic" preload="auto" loop playsinline>
    <source src="./1.mp3" type="audio/mpeg" />
  </audio>

  <!-- MAIN PHONE SCREEN -->
  <div class="phone" id="mainScreen">
    <h1>Happy Birthday <span class="name">Pargarti</span></h1>
    <p class="line">You mean more to me than words can explain üíñ</p>

    <div class="timer-box">
      <div class="time"><span id="d">00</span><small>DAYS</small></div>
      <div class="time"><span id="h">00</span><small>HRS</small></div>
      <div class="time"><span id="m">00</span><small>MIN</small></div>
      <div class="time"><span id="s">00</span><small>SEC</small></div>
    </div>

    <h2 class="status loading" id="statusText">Loading Surprise‚Ä¶ üéÅ</h2>

    <button id="btn" disabled onclick="startPopup()">Let‚Äôs Celebrate üéâ</button>
  </div>

  <!-- POPUP -->
  <div class="popup" id="popup">
    <div class="popup-card">
      <p id="popupText">‚ú® Do u wanna see what I made..? ‚ú®</p>
      <div class="popup-buttons">
        <button class="yes-btn" onclick="nextPopup()">Yes üëç</button>
        <button class="no-btn" onclick="closePopup()">No üëÄ</button>
      </div>
    </div>
  </div>

  <!-- üéâ CELEBRATION SCREEN -->
  <div class="celebration" id="celebrationScreen">
    <div class="stage">
      <!-- Night overlay + fireflies -->
      <div class="night-overlay" id="nightOverlay"></div>
      <div id="fireflyLayer"></div>

      <!-- Extra hanging flags/banners -->
      <div class="flags" id="flags">
        <span></span><span></span><span></span><span></span><span></span><span></span><span></span><span></span>
        <span></span><span></span><span></span><span></span><span></span><span></span>
      </div>

      <!-- Banner -->
      <div class="banner" id="banner">
        <span>üéà HAPPY BIRTHDAY PARGARTI üéà</span>
      </div>

      <!-- Cake -->
      <div class="cake-wrap" id="cake">
        <div class="cake3d">
          <div class="plate"></div>

          <div class="tier tier-3">
            <div class="drip"></div>
            <div class="sprinkles"></div>
          </div>

          <div class="tier tier-2">
            <div class="drip"></div>
            <div class="sprinkles"></div>
          </div>

          <div class="tier tier-1">
            <div class="drip"></div>
            <div class="sprinkles"></div>
          </div>

          <div class="candle">
            <div class="wick"></div>
            <div class="flame"></div>
          </div>
        </div>
      </div>

      <!-- Happy text -->
      <div class="happy" id="happyText">Happy Birthday üíñ</div>

      <!-- Confetti layer -->
      <div id="confettiLayer"></div>

      <!-- Envelope -->
      <div class="envelope-wrap" id="envelopeWrap">
        <div class="envelope2" id="envelope2">
          <div class="env-back"></div>
          <div class="env-front"></div>
          <div class="env-flap"></div>

          <div class="letter">
            <h3>To Pargarti üíå</h3>
            <p>
              Happy Birthday! üéâ
               Hope your day is full of cake, laughter, 
               and people who make you smile‚Ä¶ 
               especially me sneaking into that list.
              You officially get older today, 
              but somehow you‚Äôre still getting cuter 
              please explain that magic sometime ‚ú®
            </p>
            <p class="sign">‚Äî From me ‚ù§Ô∏è</p>
          </div>
        </div>

        <button class="open-btn" id="openBtn">Open Envelope ‚ú®</button>
      </div>

    </div>
  </div>

  <script>
    /* =========================
       COUNTDOWN (FIXED)
       ========================= */
    let target = new Date("2026-02-03T00:00:00");

    const btn = document.getElementById("btn");
    const statusText = document.getElementById("statusText");

    function pad2(n) {
      return String(n).padStart(2, "0");
    }

    function updateCountdown() {
      const now = new Date();
      const diff = target - now;

      if (diff <= 0) {
        statusText.innerText = "üéâ IT'S YOUR BIRTHDAY üéâ";
        statusText.classList.remove("loading");
        statusText.classList.add("birthday-glow");
        btn.disabled = false;

        document.getElementById("d").innerText = "00";
        document.getElementById("h").innerText = "00";
        document.getElementById("m").innerText = "00";
        document.getElementById("s").innerText = "00";
        return;
      }

      const days = Math.floor(diff / (1000 * 60 * 60 * 24));
      const hrs  = Math.floor((diff / (1000 * 60 * 60)) % 24);
      const mins = Math.floor((diff / (1000 * 60)) % 60);
      const secs = Math.floor((diff / 1000) % 60);

      document.getElementById("d").innerText = pad2(days);
      document.getElementById("h").innerText = pad2(hrs);
      document.getElementById("m").innerText = pad2(mins);
      document.getElementById("s").innerText = pad2(secs);
    }

    updateCountdown();
    setInterval(updateCountdown, 1000);

    /* =========================
       ‚úÖ BACKGROUND MUSIC (mobile-safe)
       - starts on "Yes" click (user gesture)
       - fade-in so it feels smooth
       ========================= */
    const bgMusic = document.getElementById("bgMusic");
    let musicStarted = false;

    function playMusic() {
      if (!bgMusic || musicStarted) return;
      musicStarted = true;

      bgMusic.volume = 0; // start silent for fade in
      const p = bgMusic.play();

      // if blocked, allow another click later
      if (p && typeof p.catch === "function") {
        p.catch(() => { musicStarted = false; });
      }

      // fade in
      let v = 0;
      const fade = setInterval(() => {
        v += 0.05;
        if (v >= 0.6) {
          bgMusic.volume = 0.6;
          clearInterval(fade);
        } else {
          bgMusic.volume = v;
        }
      }, 120);
    }

    /* =========================
       POPUPS
       ========================= */
    const messages = [
      "‚ú® Do u wanna see what I made..? ‚ú®",
      "Because it‚Äôs something special üíñ"
    ];
    let index = 0;

    function startPopup() {
      const popup = document.getElementById("popup");
      const popupText = document.getElementById("popupText");
      popup.style.display = "flex";
      index = 1;
      popupText.innerText = messages[0];
    }

    function nextPopup() {
      const popupText = document.getElementById("popupText");

      if (index < messages.length) {
        popupText.innerText = messages[index];
        index++;
        return;
      }

      // ‚úÖ show celebration
      document.getElementById("popup").style.display = "none";
      document.getElementById("mainScreen").style.display = "none";
      document.getElementById("celebrationScreen").style.display = "flex";

      // ‚úÖ start music right now (this click is the user gesture)
      playMusic();

      runCelebrationSequence();
    }

    function closePopup() {
      document.getElementById("popup").style.display = "none";
    }

    /* =========================
       CELEBRATION SEQUENCE
       ========================= */
    const banner = document.getElementById("banner");
    const happyText = document.getElementById("happyText");
    const cake = document.getElementById("cake");
    const envelopeWrap = document.getElementById("envelopeWrap");
    const confettiLayer = document.getElementById("confettiLayer");

    const celebrationScreen = document.getElementById("celebrationScreen");
    const flags = document.getElementById("flags");
    const nightOverlay = document.getElementById("nightOverlay");
    const fireflyLayer = document.getElementById("fireflyLayer");

    function runCelebrationSequence() {
      setTimeout(() => flags && flags.classList.add("show"), 250);

      setTimeout(() => banner.classList.add("show"), 350);
      setTimeout(() => burstConfetti(140), 750);
      setTimeout(() => cake.classList.add("show"), 1150);
      setTimeout(() => happyText.classList.add("show"), 1550);
      setTimeout(() => envelopeWrap.classList.add("show"), 2150);

      setTimeout(() => startNightMode(), 2600);
    }

    /* =========================
       NIGHT MODE + FIREFLIES
       ========================= */
    let fireflyInterval = null;

    function startNightMode() {
      if (celebrationScreen) celebrationScreen.classList.add("night-transition");

      spawnFireflies(18);

      if (fireflyInterval) clearInterval(fireflyInterval);
      fireflyInterval = setInterval(() => spawnFireflies(3), 1200);
    }

    function spawnFireflies(count = 10) {
      if (!fireflyLayer) return;

      for (let i = 0; i < count; i++) {
        const f = document.createElement("div");
        f.className = "firefly";

        f.style.left = (Math.random() * 100) + "%";
        f.style.top = (15 + Math.random() * 75) + "%";

        const s = 4 + Math.random() * 6;
        f.style.width = s + "px";
        f.style.height = s + "px";

        f.style.setProperty("--dur", (6 + Math.random() * 6) + "s");

        fireflyLayer.appendChild(f);
        setTimeout(() => f.remove(), 12000);
      }
    }

    /* =========================
       CONFETTI
       ========================= */
    function burstConfetti(count = 80) {
      if (!confettiLayer) return;

      for (let i = 0; i < count; i++) {
        const c = document.createElement("div");
        c.className = "confetti";
        c.style.left = Math.random() * 100 + "%";
        c.style.top = (-10 - Math.random() * 40) + "px";
        c.style.background = randomColor();
        c.style.animationDuration = (2 + Math.random() * 1.8) + "s";
        c.style.width = (6 + Math.random() * 10) + "px";
        c.style.height = (8 + Math.random() * 16) + "px";

        confettiLayer.appendChild(c);
        c.addEventListener("animationend", () => c.remove());
      }
    }

    function randomColor() {
      const colors = ["#ff4d6d", "#ffd166", "#06d6a0", "#4ea8de", "#c77dff", "#ff8fab"];
      return colors[Math.floor(Math.random() * colors.length)];
    }

    /* =========================
       ENVELOPE OPEN (SAFE)
       ========================= */
    const envelope2 = document.getElementById("envelope2");
    const openBtn = document.getElementById("openBtn");

    function toggleEnvelope(e) {
      if (e) e.stopPropagation();
      if (!envelope2) return;

      envelope2.classList.toggle("open");

      if (celebrationScreen) {
        const isOpen = envelope2.classList.contains("open");
        celebrationScreen.classList.toggle("dim", isOpen);
      }

      if (envelope2.classList.contains("open")) burstConfetti(70);
    }

    if (openBtn) openBtn.addEventListener("click", toggleEnvelope);
    if (envelope2) envelope2.addEventListener("click", toggleEnvelope);
  </script>

</body>
</html>
